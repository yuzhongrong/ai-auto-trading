# 测试验证检查清单

**版本**: v1.0  
**日期**: 2025-01-05

---

## ✅ 阶段 1: 编译验证 (已完成)

- [x] TypeScript 编译通过
- [x] 无类型错误
- [x] 无语法错误
- [x] 所有导入正确

---

## 🔲 阶段 2: Gate.io 测试网验证

### 2.1 环境配置

- [ ] 设置 `EXCHANGE_NAME=gate`
- [ ] 配置 Gate.io 测试网 API 密钥
- [ ] 确认 `IS_TESTNET=true`
- [ ] 检查数据库连接正常

### 2.2 基础功能

- [ ] 获取账户余额
- [ ] 获取市场价格
- [ ] 获取合约信息
- [ ] 设置杠杆倍数

### 2.3 开仓测试

**测试案例**: BTC 做多

- [ ] 输入参数
  - 币种: BTC
  - 方向: long
  - 保证金: 10 USDT
  - 杠杆: 5x
  - 当前价格: 记录 _______

- [ ] 执行开仓

- [ ] 验证结果
  - [ ] 张数计算正确（整数）
  - [ ] 保证金扣除正确
  - [ ] 开仓价格合理
  - [ ] 数据库记录正确

- [ ] 记录实际值
  - 计算张数: _______
  - 实际张数: _______
  - 计算保证金: _______
  - 实际保证金: _______

### 2.4 持仓监控

- [ ] 获取当前持仓
- [ ] 未实现盈亏显示正确
- [ ] 强平价格合理
- [ ] 仓位信息完整

### 2.5 平仓测试

- [ ] 执行平仓
- [ ] 验证盈亏计算
  - [ ] 毛盈亏 = (平仓价 - 开仓价) × 张数 × quantoMultiplier
  - [ ] 手续费 = (开仓价 + 平仓价) × 张数 × quantoMultiplier × 0.0005
  - [ ] 净盈亏 = 毛盈亏 - 手续费

- [ ] 记录实际值
  - 开仓价: _______
  - 平仓价: _______
  - 张数: _______
  - 系统计算盈亏: _______
  - 交易所实际盈亏: _______
  - 差异: _______

### 2.6 边缘案例

- [ ] 做空测试
- [ ] 部分平仓测试
- [ ] 止损触发测试
- [ ] 止盈触发测试

### 2.7 数据一致性

- [ ] 数据库记录与交易所一致
- [ ] 账户余额计算正确
- [ ] 历史记录完整

---

## 🔲 阶段 3: Binance 测试网验证

### 3.1 环境配置

- [ ] 设置 `EXCHANGE_NAME=binance`
- [ ] 配置 Binance 测试网 API 密钥
- [ ] 确认 `IS_TESTNET=true`
- [ ] 检查数据库连接正常

### 3.2 基础功能

- [ ] 获取账户余额
- [ ] 获取市场价格
- [ ] 获取合约信息
- [ ] 设置杠杆倍数

### 3.3 开仓测试

**测试案例**: BTC 做多

- [ ] 输入参数
  - 币种: BTC
  - 方向: long
  - 保证金: 10 USDT
  - 杠杆: 5x
  - 当前价格: 记录 _______

- [ ] 执行开仓

- [ ] 验证结果
  - [ ] 币数量计算正确（小数）
  - [ ] 保证金扣除正确
  - [ ] 开仓价格合理
  - [ ] 数据库记录正确

- [ ] 记录实际值
  - 计算数量: _______
  - 实际数量: _______
  - 计算保证金: _______
  - 实际保证金: _______

### 3.4 持仓监控

- [ ] 获取当前持仓
- [ ] 未实现盈亏显示正确
- [ ] 强平价格合理
- [ ] 仓位信息完整

### 3.5 平仓测试

- [ ] 执行平仓
- [ ] 验证盈亏计算
  - [ ] 毛盈亏 = (平仓价 - 开仓价) × 数量
  - [ ] 手续费 = (开仓价 + 平仓价) × 数量 × 0.0005
  - [ ] 净盈亏 = 毛盈亏 - 手续费

- [ ] 记录实际值
  - 开仓价: _______
  - 平仓价: _______
  - 数量: _______
  - 系统计算盈亏: _______
  - 交易所实际盈亏: _______
  - 差异: _______

### 3.6 边缘案例

- [ ] 做空测试
- [ ] 部分平仓测试
- [ ] 止损触发测试
- [ ] 止盈触发测试

### 3.7 数据一致性

- [ ] 数据库记录与交易所一致
- [ ] 账户余额计算正确
- [ ] 历史记录完整

---

## 🔲 阶段 4: 交叉验证

### 4.1 计算对比

**相同参数测试**:

| 参数 | Gate.io | Binance | 备注 |
|------|---------|---------|------|
| 保证金 | 10 USDT | 10 USDT | |
| 杠杆 | 5x | 5x | |
| 价格 | 50000 | 50000 | |
| 开仓数量 | _____ 张 | _____ BTC | |
| 名义价值 | _____ USDT | _____ USDT | 应相等 |
| 开仓手续费 | _____ USDT | _____ USDT | 应相等 |

**盈亏对比**:

| 场景 | Gate.io | Binance | 备注 |
|------|---------|---------|------|
| 涨 1000 USDT | _____ | _____ | 应相等 |
| 跌 1000 USDT | _____ | _____ | 应相等 |

### 4.2 一致性验证

- [ ] 相同保证金，名义价值相同
- [ ] 相同价格变动，盈亏相同
- [ ] 手续费计算一致

---

## 🔲 阶段 5: 压力测试

### 5.1 多币种测试

- [ ] BTC 开仓/平仓
- [ ] ETH 开仓/平仓
- [ ] SOL 开仓/平仓
- [ ] 同时持有多个仓位

### 5.2 极端场景

- [ ] 最小保证金开仓
- [ ] 最大杠杆开仓
- [ ] 快速开平仓
- [ ] 网络延迟场景

### 5.3 异常处理

- [ ] API 调用失败
- [ ] 数据库写入失败
- [ ] 价格异常波动
- [ ] 余额不足

---

## 🔲 阶段 6: 小额实盘验证

### 6.1 Gate.io 实盘

**建议配置**:

- 初始资金: ≤ 20 USDT
- 单笔保证金: ≤ 5 USDT
- 杠杆: ≤ 3x
- 测试时长: 24-48 小时

**检查清单**:

- [ ] 环境配置
  - [ ] 设置 `IS_TESTNET=false`
  - [ ] 使用实盘 API 密钥
  - [ ] 备份数据库

- [ ] 交易测试
  - [ ] 第 1 笔交易: _______
    - 开仓时间: _______
    - 平仓时间: _______
    - 盈亏: _______
    - 系统记录准确: [ ]
  
  - [ ] 第 2 笔交易: _______
  - [ ] 第 3 笔交易: _______

- [ ] 数据验证
  - [ ] 账户余额与交易所一致
  - [ ] 所有交易记录完整
  - [ ] 盈亏统计准确

### 6.2 Binance 实盘

**建议配置**:

- 初始资金: ≤ 20 USDT
- 单笔保证金: ≤ 5 USDT
- 杠杆: ≤ 3x
- 测试时长: 24-48 小时

**检查清单**:

- [ ] 环境配置
  - [ ] 设置 `IS_TESTNET=false`
  - [ ] 使用实盘 API 密钥
  - [ ] 备份数据库

- [ ] 交易测试
  - [ ] 第 1 笔交易: _______
    - 开仓时间: _______
    - 平仓时间: _______
    - 盈亏: _______
    - 系统记录准确: [ ]
  
  - [ ] 第 2 笔交易: _______
  - [ ] 第 3 笔交易: _______

- [ ] 数据验证
  - [ ] 账户余额与交易所一致
  - [ ] 所有交易记录完整
  - [ ] 盈亏统计准确

---

## 🔲 阶段 7: 最终验证

### 7.1 代码审查

- [ ] 所有硬编码已移除
- [ ] 注释准确无误
- [ ] 错误处理完善
- [ ] 日志输出清晰

### 7.2 文档审查

- [ ] API 文档更新
- [ ] 使用指南完整
- [ ] 故障排查指南
- [ ] 风险提示明确

### 7.3 监控与告警

- [ ] 异常交易告警
- [ ] 盈亏异常告警
- [ ] API 错误告警
- [ ] 数据一致性监控

---

## 📝 问题记录

### 测试中发现的问题

| 编号 | 日期 | 交易所 | 问题描述 | 严重性 | 状态 |
|------|------|--------|----------|--------|------|
| 1 | | | | | |
| 2 | | | | | |
| 3 | | | | | |

### 需要改进的地方

| 编号 | 类型 | 描述 | 优先级 |
|------|------|------|--------|
| 1 | | | |
| 2 | | | |
| 3 | | | |

---

## ✅ 最终确认

### 负责人签字

- [ ] 开发负责人: __________ 日期: __________
- [ ] 测试负责人: __________ 日期: __________
- [ ] 运维负责人: __________ 日期: __________

### 上线批准

- [ ] Gate.io 测试通过
- [ ] Binance 测试通过
- [ ] 小额实盘验证通过
- [ ] 文档完整
- [ ] 监控就绪

**批准上线**: [ ] 是 [ ] 否

**批准人**: __________ **日期**: __________

---

## 📞 紧急联系

如发现严重问题，立即采取以下措施：

1. **停止所有交易**: 关闭交易循环
2. **保护资金**: 手动平仓所有持仓
3. **记录问题**: 详细记录问题现象和日志
4. **通知团队**: 联系技术负责人
5. **回滚代码**: 必要时回滚到稳定版本

**紧急联系人**: __________  
**联系方式**: __________

---

**重要**: 本清单必须完整执行，不得跳过任何步骤！
