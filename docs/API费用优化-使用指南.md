# API费用优化使用指南

## 快速开始

系统已默认启用精简模式,无需额外配置即可降低约60%的API费用。

### 验证精简模式已启用

查看 `.env` 文件:

```bash
cat .env | grep USE_COMPACT_PROMPT
```

应该看到:

```bash
USE_COMPACT_PROMPT=true
```

### 启动系统

```bash
npm run start
```

查看日志确认精简模式:

```bash
tail -f logs/pm2-out.log
```

应该看到类似输出:

```bash
使用精简版Agent指令
【入参 - AI 提示词】
#1 2025-12-01 10:00 | 平衡 | 15min
...
```

## 费用对比

| 模式 | 每周期Tokens | 每天费用估算 | 月度费用 |
|------|-------------|-------------|----------|
| 完整版 | ~23000 | ¥6-10 | ¥180-300 |
| 精简版 | ~8500 | ¥2-4 | ¥60-120 |
| **节省** | **63%** | **60%** | **¥120-180** |

## 切换模式

### 切换到完整版 (调试用)

编辑 `.env`:

```bash
USE_COMPACT_PROMPT=false
```

重启系统:

```bash
npm run restart
```

### 切换回精简版

编辑 `.env`:

```bash
USE_COMPACT_PROMPT=true
```

重启系统:

```bash
npm run restart
```

## 监控费用

### DeepSeek控制台

访问: <https://platform.deepseek.com/usage>

查看实时tokens使用情况

### 本地日志分析

```bash
# 统计每小时API调用次数
cat logs/pm2-out.log | grep "入参 - AI 提示词" | wc -l
```

## 常见问题

### Q: 精简版会影响交易质量吗?

A: 不会。精简版保留了所有核心决策信息:

- ✅ 完整的市场数据和技术指标
- ✅ 所有持仓信息和反转监控
- ✅ 账户状态和风控规则
- ✅ 完整的工具调用能力

只是移除了:

- ❌ 冗余的说明文字和示例
- ❌ 重复的风控规则解释
- ❌ 历史交易记录(不影响当前决策)

### Q: 什么时候应该用完整版?

A: 以下情况建议临时切换到完整版:

- 调试AI决策逻辑
- 学习系统工作原理
- 分析异常交易行为
- 开发新功能测试

### Q: 如何验证优化效果?

A: 对比优化前后的DeepSeek用量:

1. 查看优化前一天的tokens使用量
2. 启用精简模式运行一天
3. 对比两天的tokens消耗
4. 预期减少60%左右

## 技术细节

详见: [API费用优化总结.md](./API费用优化总结.md)

## 反馈

如发现问题或有优化建议,请提交Issue。
